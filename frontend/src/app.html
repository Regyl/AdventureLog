<!doctype html>
<html lang="en" data-theme="">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="manifest" crossorigin="use-credentials" href="/manifest.json" />

		<!-- iOS / Safari PWA support -->
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="mobile-web-app-capable" content="yes" />
		<!-- Apple touch icons (place files in frontend/static/) -->
		<link rel="apple-touch-icon" sizes="180x180" href="%sveltekit.assets%/apple-touch-icon.png" />
		<link
			rel="apple-touch-icon"
			sizes="152x152"
			href="%sveltekit.assets%/apple-touch-icon-152.png"
		/>
		<link
			rel="apple-touch-icon"
			sizes="120x120"
			href="%sveltekit.assets%/apple-touch-icon-120.png"
		/>

		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
		<script>
			// Override global fetch to include CSRF token for API requests
			const originalFetch = window.fetch;
			window.fetch = function (input, init) {
				const url =
					typeof input === 'string' ? input : input instanceof URL ? input.href : input.url;
				const method = init?.method?.toUpperCase() || 'GET';

				// Only add CSRF token for API requests that require it
				if (url.startsWith('/api/') && ['POST', 'PUT', 'PATCH', 'DELETE'].includes(method)) {
					const csrfToken = getCookie('csrftoken');
					if (csrfToken) {
						init = {
							...init,
							headers: {
								...init?.headers,
								'X-CSRFToken': csrfToken
							}
						};
					}
				}

				return originalFetch.call(this, input, init);
			};

			// Helper function to get cookie value
			function getCookie(name) {
				const value = `; ${document.cookie}`;
				const parts = value.split(`; ${name}=`);
				if (parts.length === 2) return parts.pop().split(';').shift();
				return null;
			}
		</script>
	</body>
</html>
